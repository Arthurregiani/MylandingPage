services:
  landing:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: landing
    restart: unless-stopped
    env_file:
      - .env.production
    environment:
      - NODE_ENV=production
      - PORT=3000
    expose:
      - "3000"
    networks:
      - web

  tunnel:
    image: cloudflare/cloudflared:latest
    container_name: cf-tunnel
    restart: unless-stopped
    env_file:
      - .env
    command: tunnel --no-autoupdate run --token ${CLOUDFLARE_TUNNEL_TOKEN}
    networks:
      - web
    depends_on:
      - landing
    extra_hosts:
      - "host.docker.internal:host-gateway"

networks:
  web:
    driver: bridge
